---
title: "Problem set 5"
author: "Reid McIlroy-Young"
date: "February 13, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(ggplot2)
library(tidyr)
library(modelr)
library(broom)
library(tidyverse)

options(na.action = na.warn)
set.seed(1234)
```


``` {r Q1}
targetFile <- "data/biden.csv"

data <- read.csv(targetFile)

qplot(biden, data=data, geom="histogram", main = "Histogram of Biden 'feeling'", binwidth = 1, xlab = 'Temperature', ylab ='Count')
```


This plot shows people's preference for round numbers, as most respondents choose a multiple of 10. There is also some polarization evident, with a peak around 60 and another at 80. Most people are either warm or very hot, with almost no one at 80.

``` {r Q2 1-4}
sl <- lm(biden ~ age, data = data)

summary(sl)
```


The simple linear regression mapping age to Biden feel is statistical insignificant, the $R^2$ value is just $0.002$ ($0.2%$ of the variation explained), almost none of the variance is described by the model, although the p-value of $0.056$ indicated that with $94%$ confidence there is some relationship. The predicted relationship is quite week, with an age increase by $10$ years leading to a $0.62$ increase in the feel. This is a positive but week relationship. Once all these factors are considered is is a bad model for Biden feel.

``` {r Q2 5}
pred_aug <- augment(sl, newdata = data_frame(age = c(45)))
pred_ci <- mutate(pred_aug,
                   ymin = .fitted - .se.fit * 1.96,
                   ymax = .fitted + .se.fit * 1.96)
pred_ci
```

The predicted feel for the age of $45$ with model is $62.0$ which has a $95%$ confidence interval of $60.9$ to $63.1$.

``` {r Q2 6}
res <- add_residuals(data, sl)['resid']

grid1 <- add_predictions(data, sl) 
grid1['resid'] <- res

ggplot(grid1, aes(age, biden)) +
  geom_line(aes(y = pred), data = grid1, color = "purple", size = 1) +
  labs(title="Feeling score vs age",  x ="Age (years)", y = "Feeling Score") +
  geom_point()
```


``` {r Q3 1-3}
ml1 <- lm(biden ~ age + female + educ, data = data)

summary(ml1)

```

There is a statistically significant relationship (greater than $99%$ chance of existence) between `female` and `educ` and feeling but there is not one for `age`. The parameter for for `female` suggests that all other variables held constant being a women will increase your feeling score by $6.2$. The $R^2$ value for this model is $0.027$, this means the model predicts $2.7%$ of the variation, more than $10$ times that of the single variable model but still indicating the model is quite poor. Looking at the plot below we can see and issue, the stated party association of the respondent has a significant effect on the feeling score.

``` {r Q3 4}
grid2 <- add_predictions(data, ml1, var = 'predBase')
grid2['resid'] <- add_residuals(data, ml1)['resid']
attach(grid2)

demGrid <- subset(grid2, dem & ! rep)
repGrid <- subset(grid2, rep & ! dem)
indGrid <- subset(grid2, ! rep | dem)
bothGrid <- subset(grid2, rep & dem)

mlDem <- lm(resid ~ predBase, data = demGrid)
demGrid <- add_predictions(demGrid, mlDem)
mlRep <- lm(resid ~ predBase, data = repGrid)
repGrid <- add_predictions(repGrid, mlRep)
mlInd <- lm(resid ~ predBase, data = indGrid)
indGrid <- add_predictions(indGrid, mlInd)

#No observations
#mlBoth <- lm(resid ~ predBase, data = bothGrid)
#bothGrid <- add_predictions(indGrid, mlBoth)

ggplot(grid2, aes(x = predBase, y = resid)) +
  geom_line(aes(y = pred, color = 'dem', labels = c('test')), data = demGrid, size = 1, show.legend = TRUE) +
  geom_line(aes(y = pred, color = 'rep'), data = repGrid, size = 1, show.legend = TRUE) +
  geom_line(aes(y = pred, color = 'ind'), data = indGrid, size = 1, show.legend = TRUE) +
  #geom_line(aes(y = pred, color = 'both'), data = bothGrid, size = 1, show.legend = TRUE) +
  scale_colour_manual('legend', values = c("dem" = "red","rep" = "blue","ind" = "orange", "both" = "purple")) +
  labs(title="Predicted Feeling Scores vs Residual Values", x ="Predicted Feeling Scores", y = "Residual Values") +
  geom_point()
```


``` {r Q4 1-2}
ml2 <- lm(biden ~ age + female + educ + dem + rep, data = data)

summary(ml2)
```

Adding the political association to the model changed the predicted effect of gender, now all other things being constant being a women is predicted to increase the score by $4.1$, $2.1$ less than before. The model is better with an $R^2$ value of $.28$ a greater than ten fold increase. This model is by far the best of those explored so far, now the differences between party associations are almost completely modeled.

``` {r Q4 3, message=FALSE}

grid3 <- add_predictions(data, ml2, var = 'predBase')
grid3['resid'] <- add_residuals(data, ml2)['resid']

attach(grid3)

demGrid <- subset(grid3, dem & ! rep)
repGrid <- subset(grid3, rep & ! dem)
indGrid <- subset(grid3, ! rep | dem)
bothGrid <- subset(grid2, rep & dem)

mlDem <- lm(resid ~ predBase, data = demGrid)
demGrid <- add_predictions(demGrid, mlDem)
mlRep <- lm(resid ~ predBase, data = repGrid)
repGrid <- add_predictions(repGrid, mlRep)
mlInd <- lm(resid ~ predBase, data = indGrid)
indGrid <- add_predictions(indGrid, mlInd)

#No observations
#mlBoth <- lm(resid ~ predBase, data = bothGrid)
#bothGrid <- add_predictions(indGrid, mlBoth)


ggplot(grid3, aes(x = predBase, y = resid)) +
  geom_line(aes(y = pred, color = 'dem', labels = c('test')), data = demGrid, size = 1, show.legend = TRUE) +
  geom_line(aes(y = pred, color = 'rep'), data = repGrid, size = 1, show.legend = TRUE) +
  geom_line(aes(y = pred, color = 'ind'), data = indGrid, size = 1, show.legend = TRUE) +
  #geom_line(aes(y = pred, color = 'both'), data = bothGrid, size = 1, show.legend = TRUE) +
  geom_point() +
  scale_colour_manual('legend', values = c("dem" = "red","rep" = "blue","ind" = "orange", "both" = "purple")) +
  labs(title="Predicted Feeling Scores vs Residual Values", x ="Predicted Feeling Scores", y = "Residual Values")
```

``` {r Q5}
data2 <- subset(data, dem | rep)

ml3 <- lm(biden ~ female + dem + female * dem, data = data2)

summary(ml3)

pred_aug <- augment(ml3, newdata = data_frame(female = c(0, 0, 1, 1), dem = c(0, 1, 0, 1)))
pred_ci <- mutate(pred_aug,
                   ymin = .fitted - .se.fit * 1.96,
                   ymax = .fitted + .se.fit * 1.96)
pred_ci
```

The table above indicates that gender has an effect on how those associated with each party respond. Women from both parties give higher ratings, but non-democrats have a higher difference of around $5$ points. The table also indicates that party association has an effect on the gender warmth relationship. Republican women have a difference of $5$ points, with no overlap in the intervals, from men while democratic women are only $2.5$ higher with a good deal of overlap. All four possible states are quite distinct, with only democratic men and women having any overlap in their $95%$ confidence intervals and that being of only about half the width of those intervals.
